<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Benchmark Postgres Index Performance</title>
    
    <meta name="description" content="">
    <meta name="image" content="">
    
    <meta itemprop="name" content="Benchmark Postgres Index Performance">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="">
    
    <meta name="og:title" content="Benchmark Postgres Index Performance">
    <meta name="og:description" content="">
    
    <meta name="og:url" content="https://manhtai.github.io/posts/benchmark-postgres-index-performance/">
    <meta name="og:site_name" content="Benchmark Postgres Index Performance">
    <meta name="og:type" content="article">
    
    <meta name="article:tag" content="Postgres Benchmark ">
    <link rel="stylesheet" type="text/css" href="https://manhtai.github.io/css/style.css">
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/atom-one-light.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</head>

<body>

<header>
    
    <a href="https://manhtai.github.io/" style="float: left;color:#777;"><strong>Go slowly</strong></a>
    
    &nbsp;&nbsp;<a href="https://manhtai.github.io/about/" style="color:#777;"><strong>About</strong></a>&nbsp;&nbsp;<a href="https://manhtai.github.io/contact/" style="color:#777;"><strong>Contact</strong></a>&nbsp;&nbsp;<a href="https://manhtai.github.io/archives/" style="color:#777;"><strong>Archives</strong></a>
    
    
    
    <a href="https://manhtai.github.io/posts/index.xml" style="color:#777;float: right;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></strong></a>
</header>


<div id="loadingMask" style="width: 100%; height: 100%; position: fixed; background: #fff;"></div>
<script>
function fadeOut(el) {
  el.style.opacity = 1;

  var last = +new Date();
  var tick = function() {
    el.style.opacity = +el.style.opacity - (new Date() - last) / 80;
    last = +new Date();
    

    if (el.style.opacity > 0) {
      (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16);
    } else {
      el.style.display='none';
    }
  };

  tick();
}

function ready(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
         el = document.getElementById('loadingMask');
         fadeOut(el);
        var elements = document.querySelectorAll("img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("alt")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("alt"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });

    } else {
        document.addEventListener('DOMContentLoaded', fn);
    }
}
window.onload = ready;
</script>

<div class="content">
  <h1>Benchmark Postgres Index Performance <aside><a href="/tags/postgres/">Postgres</a>&nbsp;&nbsp;&nbsp;<a href="/tags/benchmark/">Benchmark</a>&nbsp;&nbsp;&nbsp;</aside></h1>
  <h2 id="the-question">The question</h2>
<p>We had a table contains 150.000 rows and 6 text columns. We do some <code>select</code>
query using exact match by each of the columns. 150k rows is not too much for
indexing all the 6 columns, right? Let&rsquo;s do a benchmark!</p>
<h2 id="the-benchmark">The benchmark</h2>
<h3 id="1-create-table">1. Create table</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> bench <span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span>
    md5(random()::text) <span style="color:#66d9ef">AS</span> a,
    md5(random()::text) <span style="color:#66d9ef">AS</span> b,
    md5(random()::text) <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">c</span>,
    md5(random()::text) <span style="color:#66d9ef">AS</span> d,
    md5(random()::text) <span style="color:#66d9ef">AS</span> e,
    md5(random()::text) <span style="color:#66d9ef">AS</span> f
<span style="color:#66d9ef">FROM</span>
    generate_series(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">150000</span>);
</code></pre></div><h3 id="2-select-without-index">2. Select without index</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo <span style="color:#e6db74">&#34;select * from bench where a = &#39;a&#39; and b = &#39;b&#39; and c = &#39;c&#39; and d = &#39;d&#39; and e = &#39;e&#39; order by f limit 1;&#34;</span> | pgbench -d postgres -t <span style="color:#ae81ff">50</span> -P <span style="color:#ae81ff">1</span> -f -
</code></pre></div><p>Result:</p>
<pre><code>latency average = 23.562 ms
latency stddev = 0.946 ms
</code></pre><h3 id="3-create-index">3. Create index</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">index</span> bench_a <span style="color:#66d9ef">on</span> bench(a);
</code></pre></div><p>The way you choose indexes here depends on the cardinality or uniqueness of the data.
We use random data here so one index is enough, and it will perform almost exactly as
when you index all 6 columns!</p>
<h3 id="4-select-with-index">4. Select with index</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo <span style="color:#e6db74">&#34;select * from bench where a = &#39;a&#39; and b = &#39;b&#39; and c = &#39;c&#39; and d = &#39;d&#39; and e = &#39;e&#39; order by f limit 1;&#34;</span> | pgbench -d postgres -t <span style="color:#ae81ff">50</span> -P <span style="color:#ae81ff">1</span> -f -
</code></pre></div><p>Result:</p>
<pre><code>latency average = 0.357 ms
latency stddev = 0.354 ms
</code></pre><h2 id="the-answer">The answer&hellip;</h2>
<p>&hellip;is yes. Indexing makes your queries 66 times faster!</p>

</div>


  <p>
    <small>
      <em>
        Written on November 2, 2021.
        <a href="https://github.com/manhtai/manhtai.github.io/blob/develop/content/posts/benchmark-postgres-index-performance.md">
          <svg height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
        </a>
      </em>
    </small>
  </p>






<footer>
    <span class="copyleft">&copy;</span> 2018 - 2023
</footer>
</body>
</html>

