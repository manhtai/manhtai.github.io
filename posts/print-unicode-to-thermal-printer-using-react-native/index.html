<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>How to print Unicode text to a Thermal printer using React Native</title>
    
    <meta name="description" content="">
    <meta name="image" content="">
    
    <meta itemprop="name" content="How to print Unicode text to a Thermal printer using React Native">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="">
    
    <meta name="og:title" content="How to print Unicode text to a Thermal printer using React Native">
    <meta name="og:description" content="">
    
    <meta name="og:url" content="https://manhtai.github.io/posts/print-unicode-to-thermal-printer-using-react-native/">
    <meta name="og:site_name" content="How to print Unicode text to a Thermal printer using React Native">
    <meta name="og:type" content="article">
    
    <meta name="article:tag" content="thermal printer react native ">
    <link rel="stylesheet" type="text/css" href="https://manhtai.github.io/css/style.css">
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</head>

<body>

<header>
    
    <a href="https://manhtai.github.io/" style="float: left;color:#777;"><strong>Go slowly</strong></a>
    
    &nbsp;&nbsp;<a href="https://manhtai.github.io/about/" style="color:#777;"><strong>About</strong></a>&nbsp;&nbsp;<a href="https://manhtai.github.io/contact/" style="color:#777;"><strong>Contact</strong></a>&nbsp;&nbsp;<a href="https://manhtai.github.io/archives/" style="color:#777;"><strong>Archives</strong></a>
    
    
    
    <a href="https://manhtai.github.io/posts/index.xml" style="color:#777;float: right;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></strong></a>
</header>


<div id="loadingMask" style="width: 100%; height: 100%; position: fixed; background: #fff;"></div>
<script>
function fadeOut(el) {
  el.style.opacity = 1;

  var last = +new Date();
  var tick = function() {
    el.style.opacity = +el.style.opacity - (new Date() - last) / 80;
    last = +new Date();
    

    if (el.style.opacity > 0) {
      (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16);
    } else {
      el.style.display='none';
    }
  };

  tick();
}

function ready(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
         el = document.getElementById('loadingMask');
         fadeOut(el);
        var elements = document.querySelectorAll("img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("alt")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("alt"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });

    } else {
        document.addEventListener('DOMContentLoaded', fn);
    }
}
window.onload = ready;
</script>

<div class="content">
  <h1>How to print Unicode text to a Thermal printer using React Native <aside><a href="/tags/thermal-printer/">thermal printer</a>&nbsp;&nbsp;&nbsp;<a href="/tags/react-native/">react native</a>&nbsp;&nbsp;&nbsp;</aside></h1>
  <p>In previous <a href="/posts/building-erp-using-django-react-native">post</a> about using React Native to build our own ERP app, I&rsquo;ve
mentioned about printing Vietnamese characters to a <a href="https://en.wikipedia.org/wiki/Thermal_printing">thermal printer</a>, in
this post I will show you how to do it.</p>
<p>Although this post is about printing Vietnamese using React Native, you must
keep in mind that it is not only apply to Vietnamese and React Native, but
for any <em>native</em> mobile framework to print Unicode characters to a thermal
printer. Just make sure your language is supported in thermal printer <a href="https://en.wikipedia.org/wiki/Code_page">code
page</a>.</p>
<p>Firstly, you must get a library to print arbitrary characters to a thermal
printer. We used <a href="https://github.com/rusel1989/react-native-bluetooth-serial">react-native-bluetooth-serial</a> for our ERP app.</p>
<p>It&rsquo;s API for printing out a message as simple as this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">BluetoothSerial</span>.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">Buffer</span><span style="color:#f92672">|</span>String <span style="color:#a6e22e">data</span>)
</code></pre></div><p>Secondly, you must know that a thermal printer will support some kind of
ESC/POS commands for parameterizing printed characters, like changing
font family, font size, barcode printing, etc. Depending on what thermal
printer manufacturer you are using, it will have some groups of commands that
we can use, for example, we can find ECS/POS reference about Epson printer
<a href="http://content.epson.de/fileadmin/content/files/RSD/downloads/escpos.pdf">here</a>.</p>
<p>So all we need to print out Vietnamese characters is to send out some
commands to set up the printer for using Vietnamese font and <a href="https://en.wikipedia.org/wiki/Code_page">code page</a>!</p>
<p>Our thermal printer does support only TCVN3 code page, so we must encode our
Unicode message to TCVN3, and then just print it out, like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// We use iconv to convert Unicode message to TCVN3
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">TCVN3message</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">iconv</span>.<span style="color:#a6e22e">encode</span>(<span style="color:#a6e22e">message</span>, <span style="color:#e6db74">&#39;tcvn&#39;</span>);

<span style="color:#75715e">// [0x1b, 0x74, 48] is POS command for set up TCVN3 code page
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">TCVN3codepage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Buffer</span>([<span style="color:#ae81ff">0x1b</span>, <span style="color:#ae81ff">0x74</span>, <span style="color:#ae81ff">48</span>]);

<span style="color:#75715e">// Push write command to Promise array
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">writePromises</span> <span style="color:#f92672">=</span> [];
<span style="color:#a6e22e">writePromises</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">BluetoothSerial</span>.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">TCVN3codepage</span>));
<span style="color:#a6e22e">writePromises</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">BluetoothSerial</span>.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">TCVN3message</span>));

<span style="color:#75715e">// Print out messages
</span><span style="color:#75715e"></span>Promise.<span style="color:#a6e22e">all</span>(<span style="color:#a6e22e">writePromises</span>);
</code></pre></div><p>That&rsquo;s it!</p>
<p>Using ESC/POS commands, we can customize our printing format even more, like
font size, font weight, etc. Another longer ESC/POS reference can be found
<a href="http://www.aures-support.fr/DATA/utility/Commande%20ESCPOS.pdf">here</a>.</p>
<p>A minor thing to note is that some printer will not default to character font
A for us, so the text might get too little or too large. You can use a command
to set it to character font A, like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">characterFontA</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Buffer</span>([<span style="color:#ae81ff">0x1b</span>, <span style="color:#ae81ff">0x21</span>, <span style="color:#ae81ff">0</span>]);
</code></pre></div><p>Have fun printing things out!</p>

</div>


  <p>
    <small>
      <em>
        Written on June 23, 2018.
        <a href="https://github.com/manhtai/manhtai.github.io/blob/develop/content/posts/print-unicode-to-thermal-printer-using-react-native.md">
          <svg height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
        </a>
      </em>
    </small>
  </p>



  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript">
 
var CurrentPage = 0;

function ParseLinkHeader(link) {
    var entries = link && link.split(",") || [];
    var links = {};
    for (var i in entries) {
        var entry = entries[i];
        var link = {};
        link.name = entry.match(/rel=\"([^\"]*)/)[1];
        link.url = entry.match(/<([^>]*)/)[1];
        link.page = entry.match(/page=(\d+).*$/)[1];
        links[link.name] = link;
    }
    return links;
}

function DoGithubComments(comment_id, page_id) {
    var repo_name = "manhtai/manhtai.github.io";

    if (page_id === undefined)
        page_id = 1;

    var api_url = "https://api.github.com/repos/" + repo_name;
    var api_issue_url = api_url + "/issues/" + comment_id;
    var api_comments_url = api_url + "/issues/" + comment_id + "/comments" + "?page=" + page_id;

    var url = "https://github.com/" + repo_name + "/issues/" + comment_id;

    $(document).ready(function () {
        $.getJSON(api_issue_url, function(data) {
            NbComments = data.comments;
        });

        $.ajax(api_comments_url, {
            headers: {Accept: "application/vnd.github.v3.html+json"},
            dataType: "json",
            success: function(comments, textStatus, jqXHR) {

                
                if (page_id == 1)
                    $("#gh-comments-list").append("<a href='" + url + "#new_comment_field' rel='nofollow' target='_blank' class='button'>Post new comment</a>");

                
                $.each(comments, function(i, comment) {
                    var date = new Date(comment.created_at);
                    var t = "<div id='gh-comment'>";
                    
                    t += "<b><a href='" + comment.user.html_url + "'>" + comment.user.login + "</a></b>";
                    t += " posted at ";
                    t += "<em>" + date.toUTCString() + "</em>";
                    t += "<hr>";
                    t += comment.body_html;
                    t += "</div>";
                    $("#gh-comments-list").append(t);
                });

                
                var links = ParseLinkHeader(jqXHR.getResponseHeader("Link"));
                if ("next" in links) {
                    $("#gh-load-comments").attr("onclick", "DoGithubComments(" + comment_id + "," + (page_id + 1) + ");");
                    $("#gh-load-comments").show();
                } else {
                    $("#gh-load-comments").hide();
                }
            },
            error: function() {
                $("#gh-comments-list").append("<a href='" + url + "' rel='nofollow' target='_blank'class='button'>View all comments</a>");
            }
        });
    });
}

DoGithubComments( 2 );
</script>

<div id="gh-comments">
    <br/><br/>
    <h4>Comments</h4>
    <div id="gh-comments-list"></div>
    <a href="javascript:void(0)" id="gh-load-comments" class="btn" style="display:none">Load more comments</a>
</div>





<footer>
    <span class="copyleft">&copy;</span> 2021
</footer>
</body>
</html>

